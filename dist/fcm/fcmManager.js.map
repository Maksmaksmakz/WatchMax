{"version":3,"sources":["../../src/fcm/fcmManager.js"],"names":["devices","find","err","tokens","res","status","send","serverKey","fcm","exports","pushToDevice","deviceToken","data","notification","message","to","collapse_key","response","console","log","pushToAllDevices","forEach","token"],"mappings":";;AAAA;;;;AACA;;;;;;AAEA,IAAIA,UAAU,IAAd;;AAEA,mBAASC,IAAT,CAAc,EAAd,EAAkB,UAACC,GAAD,EAAMC,MAAN,EAAiB;AACjC,MAAGD,GAAH,EAAO;AACLE,QAAIC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,8BAAgDJ,GAAhD;AACA;AACD,GAHD,MAGK;AACHF,cAAUG,MAAV;AACD;AACF,CAPD;;AAUA,IAAMI,YAAY,0JAAlB;AACA,IAAMC,MAAM,sBAAQD,SAAR,CAAZ;;AAEAE,QAAQC,YAAR,GAAuB,UAACC,WAAD,EAAcC,IAAd,EAAoBC,YAApB,EAAqC;AAC1D,MAAIC,UAAU;AACVC,QAAKJ,WADK;AAEVK,kBAAe,uBAFL;AAGVJ,UAAOA,IAHG;AAIVC,kBAAeA;AAJL,GAAd;;AAOAL,MAAIF,IAAJ,CAASQ,OAAT,EAAkB,UAASZ,GAAT,EAAce,QAAd,EAAuB;AACvC,QAAIf,GAAJ,EAAS;AACLgB,cAAQC,GAAR,CAAY,2BAAZ;AACH,KAFD,MAEO;AACHD,cAAQC,GAAR,CAAY,mCAAZ,EAAiDF,QAAjD;AACH;AACF,GAND;AAOD,CAfD;;AAkBAR,QAAQW,gBAAR,GAA2B,UAACR,IAAD,EAAOC,YAAP,EAAwB;AACjDb,UAAQqB,OAAR,CAAgB,UAAUC,KAAV,EAAiB;AAC/BJ,YAAQC,GAAR,CAAYG,MAAMA,KAAlB;AACAb,YAAQC,YAAR,CAAqBY,MAAMA,KAA3B,EAAkCV,IAAlC,EAAwCC,YAAxC;AACD,GAHD;AAID,CALD","file":"fcmManager.js","sourcesContent":["import FcmToken from \"../models/fcmToken\"\nimport FCM from \"fcm-push\"\n\nlet devices = null\n\nFcmToken.find({}, (err, tokens) => {\n  if(err){\n    res.status(500).send(`Couldn get users Error: ${err}`)\n    return\n  }else{\n    devices = tokens\n  }\n})\n\n\nconst serverKey = \"AAAAhQuHNyQ:APA91bE0qmLVwog39G1ixRLblEEBaXcJBu2htcp0uN6w3N9vKO2OhKO7qrjcmqC7kmqHYsAbDF9RcSWdXpk03vEO4wPXPeUBAG9MU510N3bM6ugeBSazhNcXKZW8UTCCE57AA4UKW8Sw\"\nconst fcm = new FCM(serverKey)\n\nexports.pushToDevice = (deviceToken, data, notification) => {\n  var message = {\n      to : deviceToken,\n      collapse_key : '<insert-collapse-key>',\n      data : data,\n      notification : notification\n  };\n\n  fcm.send(message, function(err, response){\n    if (err) {\n        console.log(\"Something has gone wrong!\");\n    } else {\n        console.log(\"Successfully sent with response: \", response);\n    }\n  });\n}\n\n\nexports.pushToAllDevices = (data, notification) => {\n  devices.forEach(function (token) {\n    console.log(token.token)\n    exports.pushToDevice(token.token, data, notification)\n  });\n}\n"]}