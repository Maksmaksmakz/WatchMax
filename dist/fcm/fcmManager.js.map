{"version":3,"sources":["../../src/fcm/fcmManager.js"],"names":["serverKey","fcm","exports","pushToDevice","deviceToken","data","notification","message","to","collapse_key","send","err","response","console","log","pushToAllDevices","find","tokens","res","status","forEach","token"],"mappings":";;AAAA;;;;AACA;;;;;;AAEA,IAAMA,YAAY,0JAAlB;AACA,IAAMC,MAAM,sBAAQD,SAAR,CAAZ;;AAEAE,QAAQC,YAAR,GAAuB,UAACC,WAAD,EAAcC,IAAd,EAAoBC,YAApB,EAAqC;AAC1D,MAAIC,UAAU;AACVC,QAAKJ,WADK;AAEVK,kBAAe,uBAFL;AAGVJ,UAAOA,IAHG;AAIVC,kBAAeA;AAJL,GAAd;;AAOAL,MAAIS,IAAJ,CAASH,OAAT,EAAkB,UAASI,GAAT,EAAcC,QAAd,EAAuB;AACvC,QAAID,GAAJ,EAAS;AACLE,cAAQC,GAAR,iCAA0CH,GAA1C;AACH,KAFD,MAEO;AACHE,cAAQC,GAAR,uCAAgDF,QAAhD;AACH;AACF,GAND;AAOD,CAfD;;AAiBAV,QAAQa,gBAAR,GAA2B,UAACV,IAAD,EAAOC,YAAP,EAAwB;AACjD,qBAASU,IAAT,CAAc,EAAd,EAAkB,UAACL,GAAD,EAAMM,MAAN,EAAiB;AACjC,QAAGN,GAAH,EAAO;AACLO,UAAIC,MAAJ,CAAW,GAAX,EAAgBT,IAAhB,2CAA6DC,GAA7D;AACA;AACD,KAHD,MAGK;AACHE,cAAQC,GAAR;AACAG,aAAOG,OAAP,CAAe,UAAUC,KAAV,EAAiB;AAC9BR,gBAAQC,GAAR,4BAAqCO,MAAMA,KAA3C;AACAnB,gBAAQC,YAAR,CAAqBkB,MAAMA,KAA3B,EAAkChB,IAAlC,EAAwCC,YAAxC;AACD,OAHD;AAID;AACF,GAXD;AAYD,CAbD","file":"fcmManager.js","sourcesContent":["import FcmToken from \"../models/fcmToken\"\nimport FCM from \"fcm-push\"\n\nconst serverKey = \"AAAAhQuHNyQ:APA91bE0qmLVwog39G1ixRLblEEBaXcJBu2htcp0uN6w3N9vKO2OhKO7qrjcmqC7kmqHYsAbDF9RcSWdXpk03vEO4wPXPeUBAG9MU510N3bM6ugeBSazhNcXKZW8UTCCE57AA4UKW8Sw\"\nconst fcm = new FCM(serverKey)\n\nexports.pushToDevice = (deviceToken, data, notification) => {\n  var message = {\n      to : deviceToken,\n      collapse_key : '<insert-collapse-key>',\n      data : data,\n      notification : notification\n  };\n\n  fcm.send(message, function(err, response){\n    if (err) {\n        console.log(`Something has gone wrong!: ${err}`);\n    } else {\n        console.log(`Successfully sent with response: ${response}`);\n    }\n  });\n}\n\nexports.pushToAllDevices = (data, notification) => {\n  FcmToken.find({}, (err, tokens) => {\n    if(err){\n      res.status(500).send(`Couldnt find and send to all devices ${err}`)\n      return\n    }else{\n      console.log(`found tokens, sending notifications now`)\n      tokens.forEach(function (token) {\n        console.log(`sent notification to: ${token.token}`)\n        exports.pushToDevice(token.token, data, notification)\n      });\n    }\n  })\n}\n"]}