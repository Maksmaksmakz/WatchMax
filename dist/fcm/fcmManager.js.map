{"version":3,"sources":["../../src/fcm/fcmManager.js"],"names":["serverKey","fcm","exports","pushToDevice","deviceToken","notification","message","to","send","err","response","console","log","pushToAllDevices","title","text","body","color","ledColor","sound","icon","find","tokens","res","status","forEach","token"],"mappings":";;AAAA;;;;AACA;;;;;;AAEA,IAAMA,YAAY,0JAAlB;AACA,IAAMC,MAAM,sBAAQD,SAAR,CAAZ;;AAEAE,QAAQC,YAAR,GAAuB,UAACC,WAAD,EAAcC,YAAd,EAA+B;AACpD,MAAIC,UAAU;AACVC,QAAKH,WADK;AAEVC,kBAAeA;AAFL,GAAd;;AAKAJ,MAAIO,IAAJ,CAASF,OAAT,EAAkB,UAASG,GAAT,EAAcC,QAAd,EAAuB;AACvC,QAAID,GAAJ,EAAS;AACLE,cAAQC,GAAR,iCAA0CH,GAA1C;AACH,KAFD,MAEO;AACHE,cAAQC,GAAR,uCAAgDF,QAAhD;AACH;AACF,GAND;AAOD,CAbD;;AAeAR,QAAQW,gBAAR,GAA2B,UAACC,KAAD,EAAQC,IAAR,EAAiB;AAC1C,MAAMV,eAAe;AACnBS,WAAQA,KADW;AAEnBE,UAAOD,IAFY;AAGnBE,WAAO,SAHY;AAInBC,cAAU,CAAC,GAAD,EAAM,CAAN,EAAS,EAAT,EAAa,CAAb,CAJS;AAKnBC,WAAO,SALY;AAMnBC,UAAM;AANa,GAArB;;AASA,qBAASC,IAAT,CAAc,EAAd,EAAkB,UAACZ,GAAD,EAAMa,MAAN,EAAiB;AACjC,QAAGb,GAAH,EAAO;AACLc,UAAIC,MAAJ,CAAW,GAAX,EAAgBhB,IAAhB,2CAA6DC,GAA7D;AACA;AACD,KAHD,MAGK;AACHE,cAAQC,GAAR;AACAU,aAAOG,OAAP,CAAe,UAAUC,KAAV,EAAiB;AAC9Bf,gBAAQC,GAAR,4BAAqCc,MAAMA,KAA3C;AACAxB,gBAAQC,YAAR,CAAqBuB,MAAMA,KAA3B,EAAkCrB,YAAlC;AACD,OAHD;AAID;AACF,GAXD;AAYD,CAtBD","file":"fcmManager.js","sourcesContent":["import FcmToken from \"../models/fcmToken\"\nimport FCM from \"fcm-push\"\n\nconst serverKey = \"AAAAhQuHNyQ:APA91bE0qmLVwog39G1ixRLblEEBaXcJBu2htcp0uN6w3N9vKO2OhKO7qrjcmqC7kmqHYsAbDF9RcSWdXpk03vEO4wPXPeUBAG9MU510N3bM6ugeBSazhNcXKZW8UTCCE57AA4UKW8Sw\"\nconst fcm = new FCM(serverKey)\n\nexports.pushToDevice = (deviceToken, notification) => {\n  var message = {\n      to : deviceToken,\n      notification : notification\n  };\n\n  fcm.send(message, function(err, response){\n    if (err) {\n        console.log(`Something has gone wrong!: ${err}`);\n    } else {\n        console.log(`Successfully sent with response: ${response}`);\n    }\n  });\n}\n\nexports.pushToAllDevices = (title, text) => {\n  const notification = {\n    title : title,\n    body : text,\n    color: \"#83c3ed\",\n    ledColor: [238, 4, 99, 1],\n    sound: \"default\",\n    icon: \"ic_stat_name\"\n  }\n\n  FcmToken.find({}, (err, tokens) => {\n    if(err){\n      res.status(500).send(`Couldnt find and send to all devices ${err}`)\n      return\n    }else{\n      console.log(`found tokens, sending notifications now`)\n      tokens.forEach(function (token) {\n        console.log(`sent notification to: ${token.token}`)\n        exports.pushToDevice(token.token, notification)\n      });\n    }\n  })\n}\n"]}